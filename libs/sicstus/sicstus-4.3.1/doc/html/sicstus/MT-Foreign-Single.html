<html lang="en">
<head>
<title>MT Foreign Single - SICStus Prolog</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="SICStus Prolog">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Foreign-Resources-and-Multiple-SICStus-Runtimes.html#Foreign-Resources-and-Multiple-SICStus-Runtimes" title="Foreign Resources and Multiple SICStus Runtimes">
<link rel="next" href="MT-Foreign-Multiple.html#MT-Foreign-Multiple" title="MT Foreign Multiple">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<link href="texinfo.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="node">
<a name="MT-Foreign-Single"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="MT-Foreign-Multiple.html#MT-Foreign-Multiple">MT Foreign Multiple</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Foreign-Resources-and-Multiple-SICStus-Runtimes.html#Foreign-Resources-and-Multiple-SICStus-Runtimes">Foreign Resources and Multiple SICStus Runtimes</a>
<hr>
</div>

<h4 class="subsection">8.3.1 Foreign Resources Supporting Only One SICStus Runtime</h4>

<p>A process will only contain one instance of the code and data of a
(dynamic) foreign resource even if the foreign resource is
loaded and used from more than one SICStus runtime.

   <p>This presents a problem in the likely event that the foreign
resource maintains some state, e.g. global variables, between
invocations of functions in the foreign resource. The global state
will probably need to be separate between SICStus runtimes.  Requiring
a foreign resource to maintain its global state on a per SICStus
runtime basis would be an incompatible change. Instead, by default,
only the first SICStus runtime that loads a foreign resource will
be allowed to use it. If a subsequent SICStus runtime (in the same
process) tries to load the foreign resource, an error will be
reported to the second SICStus runtime.

   <p>When <samp><span class="command">splfr</span></samp> builds a foreign resource, it will also
generate glue code. When the foreign resource is loaded, the
glue code will set up a global variable pointing to the dispatch
vector used in the foreign resource to access the SICStus
API. This is similar to how an embedding application accesses the
SICStus API.

   <p>The glue code will also detect if a subsequent SICStus runtime in
the same process tries to initialize the foreign resource. In this
case, an error will be reported.

   <p>This means that pre 3.9 foreign code should only need to be rebuilt with
<samp><span class="command">splfr</span></samp> to work with the latest version of SICStus. However, a
recommended change is that all C files of a foreign resource
include the header file generated by <samp><span class="command">splfr</span></samp>. Inclusion of this
generated header file may become mandatory in a future release. 
See <a href="The-Foreign-Resource-Linker.html#The-Foreign-Resource-Linker">The Foreign Resource Linker</a>.

<div class="logo">
<a href="http://sicstus.sics.se/">
<table><tr><td>&nbsp;</td></tr></table>
</a>
</div>
<div class="node">
<ul class="node">
<li><a href="index.html#Top">User's Manual</a>
<hr>
<li><a href="index.html#TOC">Table of Contents</a>
</ul>
</div>
<hr>
<a HREF="mailto:sicstus-support@sics.se?subject=Documentation%20feedback%20on%20html/sicstus/MT-Foreign-Single.html&amp;body=Feedback%20on%20documentation%20node%20html/sicstus/MT-Foreign-Single.html%20in%20User's%20Manual.">Send feedback on this subject.</a>
   </body></html>

